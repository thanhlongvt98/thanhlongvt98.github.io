<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5G LDPC Base Graphs Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #545b62;
        }
        #graph-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            margin-top: 20px;
        }
        .node {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 2px;
        }
        .node.variable {
            fill: #4CAF50;
        }
        .node.check {
            fill: #2196F3;
        }
        .node.selected {
            stroke: #FF5722;
            stroke-width: 3px;
        }
        .node.highlighted {
            stroke: #FFC107;
            stroke-width: 3px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 1.5px;
        }
        .link.hidden {
            stroke-opacity: 0;
            stroke-width: 0;
        }
        .link.visible {
            stroke-opacity: 0.8;
            stroke-width: 2px;
        }
        .legend {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #fff;
        }
        .legend-color.variable {
            background: #4CAF50;
        }
        .legend-color.check {
            background: #2196F3;
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 14px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 13px;
            flex-wrap: wrap;
        }
        .stat-item {
            padding: 8px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
            font-size: 14px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 5px 0;
        }
        #matrix-container {
            margin-top: 20px;
        }
        #matrix-display {
            max-height: 400px;
            overflow: auto;
            background: white;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
        }
        .matrix-table {
            border-collapse: collapse;
            width: 100%;
        }
        .matrix-table td {
            padding: 2px 4px;
            text-align: center;
            border: 1px solid #e0e0e0;
            min-width: 25px;
        }
        .matrix-table td.non-zero {
            background: #e3f2fd;
            font-weight: 600;
        }
        .matrix-table td.zero {
            background: #f5f5f5;
            color: #999;
        }
        .matrix-table td.neg-one {
            background: white;
            color: #ccc;
        }
        .matrix-header {
            background: #f0f0f0;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>5G LDPC Base Graphs Visualizer</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="graph-select">Select Base Graph:</label>
                <select id="graph-select">
                    <option value="BG1">BG1</option>
                    <option value="BG2">BG2</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Filter Mode:</label>
                <select id="filter-mode">
                    <option value="all">Show All Edges</option>
                    <option value="selected">Show Only Selected Nodes' Edges</option>
                </select>
            </div>
            
            <div class="control-group">
                <button id="clear-selection">Clear Selection</button>
            </div>
            
            <div class="control-group">
                <button id="reset-view" class="secondary">Reset View</button>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="stats">
                <div class="stat-item">
                    <strong>Graph:</strong> <span id="current-graph">BG1</span>
                </div>
                <div class="stat-item">
                    <strong>Check Nodes:</strong> <span id="check-count">0</span>
                </div>
                <div class="stat-item">
                    <strong>Variable Nodes:</strong> <span id="variable-count">0</span>
                </div>
                <div class="stat-item">
                    <strong>Total Edges:</strong> <span id="edge-count">0</span>
                </div>
                <div class="stat-item">
                    <strong>Selected Nodes:</strong> <span id="selected-count">0</span>
                </div>
            </div>
        </div>
        
        <div id="graph-container"></div>
        
        <div id="matrix-container" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; border: 1px solid #ddd;">
            <h3 style="margin-top: 0; color: #333;">Base Graph Matrix</h3>
            <div id="matrix-display" style="max-height: 400px; overflow: auto; background: white; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 11px;">
                <p style="color: #666; margin: 0;">Select a graph to view its matrix</p>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color variable"></div>
                <span>Variable Node (Green)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color check"></div>
                <span>Check Node (Blue)</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 2px; background: #999; margin: 0 4px;"></div>
                <span>Edge</span>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <ul>
                <li><strong>Click on nodes</strong> to select/deselect them (selected nodes have red borders)</li>
                <li><strong>Hover over nodes</strong> to highlight connected nodes (yellow borders)</li>
                <li><strong>Drag nodes</strong> to temporarily move them (they snap back when released)</li>
                <li>Use <strong>"Show Only Selected Nodes' Edges"</strong> to filter edges connected to selected nodes</li>
                <li>Use <strong>"Reset View"</strong> to reset nodes to their grid positions</li>
                <li>Nodes are <strong>frozen in place</strong> after generation for stable visualization</li>
            </ul>
        </div>
    </div>

    <script>
        // Embedded graphs data
        const graphsData = {"BG1": {"matrix": [[250, 69, 226, 159, -1, 100, 10, -1, -1, 59, 229, 110, 191, 9, -1, 195, 23, -1, 190, 35, 239, 31, 1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [2, -1, 239, 117, 124, 71, -1, 222, 104, 173, -1, 220, 102, -1, 109, 132, 142, 155, -1, 255, -1, 28, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [106, 111, 185, -1, 63, 117, 93, 229, 177, 95, 39, -1, -1, 142, 225, 225, -1, 245, 205, 251, 117, -1, -1, -1, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [121, 89, -1, 84, 20, -1, 150, 131, 243, -1, 136, 86, 246, 219, 211, -1, 240, 76, 244, -1, 144, 12, 1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [157, 102, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [205, 236, -1, 194, -1, -1, -1, -1, -1, -1, -1, -1, 231, -1, -1, -1, 28, -1, -1, -1, -1, 123, 115, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [183, -1, -1, -1, -1, -1, 22, -1, -1, -1, 28, 67, -1, 244, -1, -1, -1, 11, 157, -1, 211, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [220, 44, -1, -1, 159, -1, -1, 31, 167, -1, -1, -1, -1, -1, 104, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [112, 4, -1, 7, -1, -1, -1, -1, -1, -1, -1, -1, 211, -1, -1, -1, 102, -1, -1, 164, -1, 109, 241, -1, 90, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [103, 182, -1, -1, -1, -1, -1, -1, -1, -1, 109, 21, -1, 142, -1, -1, -1, 14, 61, -1, 216, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 98, 149, -1, 167, -1, -1, 160, 49, -1, -1, -1, -1, -1, 58, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [77, 41, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 83, -1, -1, -1, 182, -1, -1, -1, -1, 78, 252, 22, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [160, 42, -1, -1, -1, -1, -1, -1, -1, -1, 21, 32, -1, 234, -1, -1, -1, -1, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [177, -1, -1, 248, -1, -1, -1, 151, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 185, -1, -1, 62, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [206, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 55, -1, -1, 206, 127, 16, -1, -1, -1, 229, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [40, 96, -1, -1, -1, -1, -1, -1, -1, -1, 65, -1, -1, 63, -1, -1, -1, -1, 75, -1, -1, -1, -1, -1, -1, 179, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 64, -1, 49, -1, -1, -1, -1, -1, -1, -1, 49, -1, -1, -1, -1, -1, -1, -1, -1, 51, -1, 154, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 164, -1, 59, 1, -1, -1, -1, 144, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 42, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 233, 8, -1, -1, -1, -1, 155, 147, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [60, 73, -1, -1, -1, -1, -1, 72, 127, -1, 224, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [151, -1, -1, 186, -1, -1, -1, -1, -1, 217, -1, 47, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 160, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 249, -1, -1, -1, 121, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 109, -1, -1, -1, 131, 171, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [64, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 142, 188, -1, -1, -1, 158, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 156, 147, -1, -1, -1, -1, -1, -1, -1, 170, -1, -1, -1, -1, -1, -1, -1, 152, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [112, -1, -1, 86, 236, -1, -1, -1, -1, -1, -1, 116, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 222, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 23, -1, -1, -1, -1, 136, 116, -1, -1, -1, -1, -1, -1, 182, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [195, -1, 243, -1, 215, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 61, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 25, -1, -1, -1, -1, 104, -1, 194, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [128, -1, -1, -1, 165, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 181, -1, 63, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 86, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 236, -1, -1, -1, 84, -1, -1, -1, -1, -1, -1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [216, -1, -1, -1, -1, -1, -1, -1, -1, -1, 73, -1, -1, 120, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 95, -1, -1, -1, -1, -1, 177, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 172, -1, -1, 61, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [221, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 112, -1, 199, -1, -1, -1, -1, -1, -1, -1, -1, -1, 121, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 2, 187, -1, -1, -1, -1, -1, -1, -1, -1, 41, -1, -1, -1, -1, -1, -1, -1, -1, -1, 211, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [127, -1, -1, -1, -1, -1, -1, 167, -1, -1, -1, -1, -1, -1, -1, 164, -1, 159, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 161, -1, -1, -1, -1, 197, -1, -1, -1, -1, -1, 207, -1, -1, -1, -1, -1, -1, -1, -1, -1, 103, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [37, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 105, 51, -1, -1, 120, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 198, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 220, -1, -1, -1, -1, -1, -1, -1, -1, -1, 122, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1], [167, -1, -1, -1, -1, -1, -1, -1, -1, 151, 157, -1, 163, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1], [-1, 173, -1, 139, -1, -1, -1, 149, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1], [157, -1, -1, -1, -1, -1, -1, -1, 137, -1, -1, -1, -1, -1, -1, -1, -1, 149, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1], [-1, 167, -1, 173, -1, -1, -1, -1, -1, 139, -1, -1, -1, -1, -1, -1, -1, -1, 151, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1], [149, -1, -1, -1, 157, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 137, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1], [-1, 151, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 163, -1, 173, -1, -1, -1, -1, -1, -1, 139, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1], [139, -1, -1, -1, -1, -1, -1, 157, -1, 163, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 173, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1], [-1, 149, -1, -1, -1, -1, 151, -1, -1, -1, 167, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0]], "shape": [46, 68], "nnz": 3078}, "BG2": {"matrix": [[9, 117, 204, 26, -1, -1, 189, -1, -1, 205, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [167, -1, -1, 166, 253, 125, 226, 156, 224, 252, -1, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [81, 114, -1, 44, 52, -1, -1, -1, 240, -1, 1, -1, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 8, 58, -1, 158, 104, 209, 54, 18, 128, 0, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [179, 214, -1, -1, -1, -1, -1, -1, -1, -1, -1, 71, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [231, 41, -1, -1, -1, 194, -1, 159, -1, -1, -1, 103, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [155, -1, -1, -1, -1, 228, -1, 45, -1, 28, -1, 158, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 129, -1, -1, -1, 147, -1, 140, -1, -1, -1, 3, -1, 116, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [142, 94, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 230, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 203, -1, -1, -1, -1, -1, -1, 205, -1, 61, 247, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [11, 185, -1, -1, -1, -1, 0, 117, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [11, -1, -1, -1, -1, -1, -1, 236, -1, 210, -1, -1, -1, 56, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 63, -1, 111, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [83, 2, -1, -1, -1, -1, -1, -1, 38, -1, -1, -1, -1, 222, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 115, -1, -1, -1, -1, 145, -1, -1, -1, -1, 3, -1, 232, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [51, -1, -1, -1, -1, -1, -1, -1, -1, -1, 175, 213, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 203, -1, -1, -1, -1, -1, -1, -1, 142, -1, 8, 242, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 254, -1, -1, -1, 124, -1, -1, -1, -1, -1, 114, 64, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [220, -1, -1, -1, -1, -1, 194, 50, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [87, 20, -1, -1, -1, -1, -1, -1, -1, -1, 185, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 26, -1, -1, 105, -1, -1, -1, -1, -1, -1, 29, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [76, -1, -1, -1, -1, -1, -1, -1, 42, -1, -1, -1, -1, 210, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 222, 63, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [23, -1, -1, 235, -1, 238, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 46, 139, -1, -1, -1, -1, -1, -1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [228, -1, -1, -1, -1, 156, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, 29, -1, -1, -1, -1, 143, -1, -1, -1, -1, 160, 122, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [8, -1, -1, -1, -1, -1, 151, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 98, 101, -1, -1, 135, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [18, -1, -1, -1, 28, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, 71, -1, -1, 240, -1, 9, -1, 84, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, 106, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], [242, -1, -1, -1, -1, 44, -1, -1, -1, -1, -1, -1, 166, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1], [-1, -1, 132, -1, -1, -1, -1, 164, -1, -1, 235, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1], [147, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 85, 36, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1], [-1, 57, -1, -1, -1, 40, -1, -1, -1, -1, -1, 63, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1], [140, -1, 38, -1, -1, -1, -1, 154, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1], [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 219, -1, -1, 151, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1], [-1, 31, -1, -1, -1, 66, -1, -1, -1, -1, -1, 38, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1], [239, -1, -1, -1, -1, -1, -1, 172, -1, -1, -1, -1, 34, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1], [-1, -1, 0, -1, -1, -1, -1, -1, -1, -1, 75, -1, -1, 120, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1], [-1, 129, -1, -1, -1, 229, -1, -1, -1, -1, -1, 118, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0]], "shape": [42, 52], "nnz": 2136}};
        
        let currentGraph = 'BG1';
        let selectedNodes = new Set();
        let graphData = null;
        let simulation = null;
        let svg = null;
        let width = Math.min(1200, window.innerWidth - 80);
        let height = Math.min(800, window.innerHeight - 300);
        let nodePositions = new Map();  // Store target positions for nodes

        function calculateGridLayout(nodes, startX, endX, padding, availableHeight) {
            // Calculate optimal number of columns based on node count and available space
            const nodeCount = nodes.length;
            const maxRows = Math.floor(availableHeight / 30);  // Minimum 30px between nodes
            const numCols = Math.max(1, Math.ceil(nodeCount / maxRows));
            const numRows = Math.ceil(nodeCount / numCols);
            
            const colWidth = (endX - startX) / numCols;
            const rowHeight = availableHeight / (numRows - 1 || 1);
            
            const positions = [];
            nodes.forEach((node, i) => {
                const col = Math.floor(i / numRows);
                const row = i % numRows;
                const x = startX + col * colWidth + colWidth / 2;
                const y = padding + row * rowHeight;
                positions.push({x, y, node});
            });
            
            return {positions, numCols, numRows};
        }

        function parseMatrixToGraph(matrix, graphName) {
            const nodes = [];
            const links = [];
            const checkNodes = new Map();
            const variableNodes = new Map();
            
            const numRows = matrix.length;
            const numCols = matrix[0].length;
            
            // Create variable nodes (columns)
            for (let i = 0; i < numCols; i++) {
                const nodeId = `v${i}`;
                variableNodes.set(i, nodeId);
                nodes.push({
                    id: nodeId,
                    type: 'variable',
                    index: i,
                    label: `V${i}`
                });
            }
            
            // Create check nodes (rows)
            for (let j = 0; j < numRows; j++) {
                const nodeId = `c${j}`;
                checkNodes.set(j, nodeId);
                nodes.push({
                    id: nodeId,
                    type: 'check',
                    index: j,
                    label: `C${j}`
                });
            }
            
            // Create edges (where matrix value >= 0, -1 means no connection)
            for (let j = 0; j < numRows; j++) {
                for (let i = 0; i < numCols; i++) {
                    const value = matrix[j][i];
                    if (value >= 0) {  // -1 means no connection
                        const source = variableNodes.get(i);
                        const target = checkNodes.get(j);
                        links.push({
                            source: source,
                            target: target,
                            value: value
                        });
                    }
                }
            }
            
            return { nodes, links };
        }

        function initializeVisualization() {
            // Setup SVG
            const container = d3.select('#graph-container');
            container.selectAll('*').remove();
            
            svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Update stats
            updateStats();
            
            // Load initial graph
            loadGraph(currentGraph);
            
            // Setup event listeners
            document.getElementById('graph-select').addEventListener('change', (e) => {
                currentGraph = e.target.value;
                selectedNodes.clear();
                loadGraph(currentGraph);
            });
            
            document.getElementById('filter-mode').addEventListener('change', () => {
                updateVisualization();
            });
            
            document.getElementById('clear-selection').addEventListener('click', () => {
                selectedNodes.clear();
                updateVisualization();
            });
            
            document.getElementById('reset-view').addEventListener('click', () => {
                if (simulation && graphData) {
                    // Reinitialize bipartite positions with multi-column layout
                    const variableNodes = graphData.nodes.filter(n => n.type === 'variable');
                    const checkNodes = graphData.nodes.filter(n => n.type === 'check');
                    
                    const leftStartX = width * 0.05;
                    const leftEndX = width * 0.45;
                    const rightStartX = width * 0.55;
                    const rightEndX = width * 0.95;
                    const padding = 40;
                    const availableHeight = height - 2 * padding;
                    
                    // Recalculate grid layouts
                    const varLayout = calculateGridLayout(variableNodes, leftStartX, leftEndX, padding, availableHeight);
                    const checkLayout = calculateGridLayout(checkNodes, rightStartX, rightEndX, padding, availableHeight);
                    
                    // Update node positions and freeze them
                    nodePositions.clear();
                    varLayout.positions.forEach(({x, y, node}) => {
                        node.fx = x;
                        node.fy = y;  // Freeze Y position
                        nodePositions.set(node.id, {x, y});
                    });
                    
                    checkLayout.positions.forEach(({x, y, node}) => {
                        node.fx = x;
                        node.fy = y;  // Freeze Y position
                        nodePositions.set(node.id, {x, y});
                    });
                    
                    // Update force simulation
                    simulation.force('x', d3.forceX().x(d => {
                        const pos = nodePositions.get(d.id);
                        return pos ? pos.x : (d.type === 'variable' ? (leftStartX + leftEndX) / 2 : (rightStartX + rightEndX) / 2);
                    }).strength(0.8));
                    simulation.force('y', d3.forceY().y(d => {
                        const pos = nodePositions.get(d.id);
                        return pos ? pos.y : height / 2;
                    }).strength(0.3));
                    
                    simulation.alpha(1).restart();
                }
            });
        }

        function displayMatrix(graphName) {
            if (!graphsData[graphName]) {
                document.getElementById('matrix-display').innerHTML = '<p style="color: #666;">Matrix not available</p>';
                return;
            }
            
            const matrix = graphsData[graphName].matrix;
            const numRows = matrix.length;
            const numCols = matrix[0].length;
            
            let html = `<p style="margin-bottom: 10px;"><strong>Dimensions:</strong> ${numRows} × ${numCols} (Check Nodes × Variable Nodes)</p>`;
            html += '<div style="overflow-x: auto;">';
            html += '<table class="matrix-table">';
            
            // Header row with variable node indices
            html += '<thead><tr><th class="matrix-header"></th>';
            for (let j = 0; j < numCols; j++) {
                html += `<th class="matrix-header">V${j}</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // Matrix rows
            for (let i = 0; i < numRows; i++) {
                html += `<tr><th class="matrix-header">C${i}</th>`;
                for (let j = 0; j < numCols; j++) {
                    const value = matrix[i][j];
                    let cellClass = '';
                    let displayValue = '';
                    
                    if (value === -1) {
                        cellClass = 'neg-one';
                        displayValue = '·';
                    } else if (value === 0) {
                        cellClass = 'zero';
                        displayValue = '0';
                    } else {
                        cellClass = 'non-zero';
                        displayValue = value.toString();
                    }
                    
                    html += `<td class="${cellClass}" title="Row ${i}, Col ${j}: ${value}">${displayValue}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            document.getElementById('matrix-display').innerHTML = html;
        }

        function loadGraph(graphName) {
            if (!graphsData[graphName]) {
                console.error(`Graph ${graphName} not found`);
                return;
            }
            
            const matrix = graphsData[graphName].matrix;
            graphData = parseMatrixToGraph(matrix, graphName);
            
            document.getElementById('current-graph').textContent = graphName;
            updateStats();
            displayMatrix(graphName);
            renderGraph();
        }

        function updateStats() {
            if (!graphData) return;
            
            const checkNodes = graphData.nodes.filter(n => n.type === 'check').length;
            const variableNodes = graphData.nodes.filter(n => n.type === 'variable').length;
            const edges = graphData.links.length;
            
            document.getElementById('check-count').textContent = checkNodes;
            document.getElementById('variable-count').textContent = variableNodes;
            document.getElementById('edge-count').textContent = edges;
            document.getElementById('selected-count').textContent = selectedNodes.size;
        }

        function renderGraph() {
            if (!graphData || !svg) return;
            
            // Clear previous graph
            svg.selectAll('*').remove();
            
            // Separate variable and check nodes
            const variableNodes = graphData.nodes.filter(n => n.type === 'variable');
            const checkNodes = graphData.nodes.filter(n => n.type === 'check');
            
            // Calculate positions for bipartite layout with multiple columns
            const leftStartX = width * 0.05;   // Variable nodes start
            const leftEndX = width * 0.45;    // Variable nodes end
            const rightStartX = width * 0.55; // Check nodes start
            const rightEndX = width * 0.95;   // Check nodes end
            const padding = 40;
            const availableHeight = height - 2 * padding;
            
            // Calculate grid layouts
            const varLayout = calculateGridLayout(variableNodes, leftStartX, leftEndX, padding, availableHeight);
            const checkLayout = calculateGridLayout(checkNodes, rightStartX, rightEndX, padding, availableHeight);
            
            // Store target positions for force simulation
            nodePositions.clear();
            
            // Initialize positions for variable nodes (left side, multiple columns)
            varLayout.positions.forEach(({x, y, node}) => {
                node.x = x;
                node.y = y;
                node.fx = x;  // Fix X position
                node.fy = y;  // Fix Y position - freeze nodes
                nodePositions.set(node.id, {x, y});
            });
            
            // Initialize positions for check nodes (right side, multiple columns)
            checkLayout.positions.forEach(({x, y, node}) => {
                node.x = x;
                node.y = y;
                node.fx = x;  // Fix X position
                node.fy = y;  // Fix Y position - freeze nodes
                nodePositions.set(node.id, {x, y});
            });
            
            // Create force simulation (minimal, just for initial positioning)
            simulation = d3.forceSimulation(graphData.nodes)
                .force('link', d3.forceLink(graphData.links).id(d => d.id).distance(30))
                .force('charge', d3.forceManyBody().strength(-50))  // Very weak
                .force('collision', d3.forceCollide().radius(12))
                // Strong forces to keep nodes in their grid positions
                .force('x', d3.forceX().x(d => {
                    const pos = nodePositions.get(d.id);
                    return pos ? pos.x : (d.type === 'variable' ? (leftStartX + leftEndX) / 2 : (rightStartX + rightEndX) / 2);
                }).strength(1.0))
                // Y force to keep nodes in their grid positions
                .force('y', d3.forceY().y(d => {
                    const pos = nodePositions.get(d.id);
                    return pos ? pos.y : height / 2;
                }).strength(1.0))
                .alphaDecay(0.1)  // Faster decay to stop quickly
                .on('end', () => {
                    // Freeze all nodes after simulation ends
                    graphData.nodes.forEach(n => {
                        const pos = nodePositions.get(n.id);
                        if (pos) {
                            n.fx = pos.x;
                            n.fy = pos.y;
                        }
                    });
                });
            
            // Create links
            const link = svg.append('g')
                .attr('class', 'links')
                .selectAll('line')
                .data(graphData.links)
                .enter()
                .append('line')
                .attr('class', 'link')
                .attr('stroke-width', 1.5);
            
            // Create nodes
            const node = svg.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(graphData.nodes)
                .enter()
                .append('circle')
                .attr('class', d => `node ${d.type}`)
                .attr('r', 8)
                .call(drag(simulation))
                .on('click', function(event, d) {
                    event.stopPropagation();
                    toggleNodeSelection(d.id);
                })
                .on('mouseover', function(event, d) {
                    highlightNode(d.id);
                })
                .on('mouseout', function() {
                    unhighlightNode();
                });
            
            // Add labels
            const labels = svg.append('g')
                .attr('class', 'labels')
                .selectAll('text')
                .data(graphData.nodes)
                .enter()
                .append('text')
                .text(d => d.label)
                .attr('font-size', '10px')
                .attr('dx', 12)
                .attr('dy', 4)
                .style('pointer-events', 'none');
            
            // Update positions on tick
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
                
                labels
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });
            
            updateVisualization();
        }

        function toggleNodeSelection(nodeId) {
            if (selectedNodes.has(nodeId)) {
                selectedNodes.delete(nodeId);
            } else {
                selectedNodes.add(nodeId);
            }
            updateVisualization();
        }

        function highlightNode(nodeId) {
            if (!graphData) return;
            
            const node = graphData.nodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // Find connected nodes
            const connectedNodeIds = new Set();
            graphData.links.forEach(link => {
                const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                if (sourceId === nodeId || targetId === nodeId) {
                    connectedNodeIds.add(sourceId);
                    connectedNodeIds.add(targetId);
                }
            });
            
            // Highlight connected nodes
            svg.selectAll('.node')
                .classed('highlighted', d => connectedNodeIds.has(d.id));
        }

        function unhighlightNode() {
            svg.selectAll('.node')
                .classed('highlighted', false);
        }

        function updateVisualization() {
            if (!graphData || !svg) return;
            
            const filterMode = document.getElementById('filter-mode').value;
            
            // Update node selection styling
            svg.selectAll('.node')
                .classed('selected', d => selectedNodes.has(d.id));
            
            // Update link visibility based on filter mode
            if (filterMode === 'all') {
                svg.selectAll('.link')
                    .classed('hidden', false)
                    .classed('visible', true);
            } else if (filterMode === 'selected') {
                if (selectedNodes.size === 0) {
                    // If no selection, hide all edges
                    svg.selectAll('.link')
                        .classed('hidden', true)
                        .classed('visible', false);
                } else {
                    // Show only edges connected to selected nodes
                    svg.selectAll('.link')
                        .classed('hidden', d => {
                            const sourceId = typeof d.source === 'object' ? d.source.id : d.source;
                            const targetId = typeof d.target === 'object' ? d.target.id : d.target;
                            return !selectedNodes.has(sourceId) && !selectedNodes.has(targetId);
                        })
                        .classed('visible', d => {
                            const sourceId = typeof d.source === 'object' ? d.source.id : d.source;
                            const targetId = typeof d.target === 'object' ? d.target.id : d.target;
                            return selectedNodes.has(sourceId) || selectedNodes.has(targetId);
                        });
                }
            }
            
            updateStats();
        }

        function drag(simulation) {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                // Snap back to frozen position
                const pos = nodePositions.get(d.id);
                if (pos) {
                    d.fx = pos.x;
                    d.fy = pos.y;  // Keep frozen
                } else {
                    d.fx = null;
                    d.fy = null;
                }
            }
            
            return d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            width = Math.min(1200, window.innerWidth - 80);
            height = Math.min(800, window.innerHeight - 300);
            if (svg) {
                svg.attr('width', width).attr('height', height);
                if (simulation && graphData) {
                    const variableNodes = graphData.nodes.filter(n => n.type === 'variable');
                    const checkNodes = graphData.nodes.filter(n => n.type === 'check');
                    
                    const leftStartX = width * 0.05;
                    const leftEndX = width * 0.45;
                    const rightStartX = width * 0.55;
                    const rightEndX = width * 0.95;
                    const padding = 40;
                    const availableHeight = height - 2 * padding;
                    
                    // Recalculate grid layouts
                    const varLayout = calculateGridLayout(variableNodes, leftStartX, leftEndX, padding, availableHeight);
                    const checkLayout = calculateGridLayout(checkNodes, rightStartX, rightEndX, padding, availableHeight);
                    
                    // Update node positions and freeze them
                    nodePositions.clear();
                    varLayout.positions.forEach(({x, y, node}) => {
                        node.fx = x;
                        node.fy = y;  // Freeze Y position
                        nodePositions.set(node.id, {x, y});
                    });
                    
                    checkLayout.positions.forEach(({x, y, node}) => {
                        node.fx = x;
                        node.fy = y;  // Freeze Y position
                        nodePositions.set(node.id, {x, y});
                    });
                    
                    // Update force positions
                    simulation.force('x', d3.forceX().x(d => {
                        const pos = nodePositions.get(d.id);
                        return pos ? pos.x : (d.type === 'variable' ? (leftStartX + leftEndX) / 2 : (rightStartX + rightEndX) / 2);
                    }).strength(1.0));
                    simulation.force('y', d3.forceY().y(d => {
                        const pos = nodePositions.get(d.id);
                        return pos ? pos.y : height / 2;
                    }).strength(1.0));
                    
                    // Restart simulation and freeze after it ends
                    simulation.alpha(1).restart();
                    setTimeout(() => {
                        graphData.nodes.forEach(n => {
                            const pos = nodePositions.get(n.id);
                            if (pos) {
                                n.fx = pos.x;
                                n.fy = pos.y;
                            }
                        });
                    }, 500);
                }
            }
        });
        
        // Initialize when page loads
        initializeVisualization();
    </script>
</body>
</html>